// Script: OsaWaterII_1997Training
// Authors: Tanner Johnson, Taufiq Rashid, John Langstaff
// Date: August 7, 2018 
// Project: Osa Peninsula Water Resources II, Summer 2018 
// Node: Athens - Georgia
// Contacts: tannerjohnson56@gmail.com, taufiq.rashid06@gmail.com, jtlang24@gmail.com

// Description: This code classifies land use on the Osa peninsula based on Landsat 5 imagery using training 
//              data from 1997. The code creates a cloud free, greenest pixel composite to use for classification. 
//              In addition to standard Landsat 5 bands, it classifies based on NDVI, EVI, NDWI, NDMI, NDBI, slope and 
//              Tasseled-Cap indices (brightness, greenness, and wetness).

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Assets
var PalmPlantation = /* color: #f5f907 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.45671892166138, 8.920431860767245],
                  [-83.4567403793335, 8.919965501528074],
                  [-83.45622539520264, 8.919923105204065],
                  [-83.45622539520264, 8.920495455162797]]]),
            {
              "landcover": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.47304821014404, 8.891304464289291],
                  [-83.47306966781616, 8.89081686804855],
                  [-83.47249031066895, 8.890795668197258],
                  [-83.47246885299683, 8.89138926356926]]]),
            {
              "landcover": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.05138349533081, 8.63393389595559],
                  [-83.05129766464233, 8.633212602057412],
                  [-83.05037498474121, 8.633255031148412],
                  [-83.05037498474121, 8.634061182970987]]]),
            {
              "landcover": 1,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.06423664093018, 8.662381475138123],
                  [-83.06419372558594, 8.661766300414198],
                  [-83.0635929107666, 8.661787513352454],
                  [-83.0635929107666, 8.662466326745228]]]),
            {
              "landcover": 1,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.4764814376831, 8.879474772406128],
                  [-83.47652435302734, 8.878965959891415],
                  [-83.47581624984741, 8.878965959891415],
                  [-83.47581624984741, 8.879517173417169]]]),
            {
              "landcover": 1,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.4735631942749, 8.883460446012299],
                  [-83.47352027893066, 8.882697235271491],
                  [-83.47268342971802, 8.882697235271491],
                  [-83.47270488739014, 8.883608847916273]]]),
            {
              "landcover": 1,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.4862232208252, 8.87792713214878],
                  [-83.4862232208252, 8.877481919358436],
                  [-83.4856653213501, 8.877524320599848],
                  [-83.4856653213501, 8.878033135114457]]]),
            {
              "landcover": 1,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.49021434783936, 8.910722986468917],
                  [-83.49021434783936, 8.910256614832848],
                  [-83.48961353302002, 8.910256614832848],
                  [-83.48957061767578, 8.910892576007202]]]),
            {
              "landcover": 1,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.49210262298584, 8.916700970173636],
                  [-83.49210262298584, 8.916234606169054],
                  [-83.49124431610107, 8.916234606169054],
                  [-83.49120140075684, 8.91699774695739]]]),
            {
              "landcover": 1,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.4627914428711, 8.913351615467214],
                  [-83.4627914428711, 8.912885247186209],
                  [-83.4620189666748, 8.912885247186209],
                  [-83.46197605133057, 8.913521203785425]]]),
            {
              "landcover": 1,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.50665092468262, 8.9363725090314],
                  [-83.50666165351868, 8.935927367408981],
                  [-83.50609302520752, 8.935937966025351],
                  [-83.50610375404358, 8.936393706237947]]]),
            {
              "landcover": 1,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.05569648742676, 8.645559266155997],
                  [-83.05569648742676, 8.644795566706119],
                  [-83.05505275726318, 8.644795566706119],
                  [-83.05505275726318, 8.645559266155997]]]),
            {
              "landcover": 1,
              "system:index": "11"
            })]),
    Mangrove = /* color: #22f7aa */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.58621597290039, 8.873623385876924],
                  [-83.58621597290039, 8.872393734813654],
                  [-83.58501434326172, 8.872393734813654],
                  [-83.58497142791748, 8.87387779592734]]]),
            {
              "landcover": 2,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.5561752319336, 8.871672902964693],
                  [-83.5561752319336, 8.870146430847264],
                  [-83.55420112609863, 8.871248883568772]]]),
            {
              "landcover": 2,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.55978012084961, 8.890583669616982],
                  [-83.55900764465332, 8.8872764758787],
                  [-83.55694770812988, 8.888887676557626],
                  [-83.55840682983398, 8.891431663201862]]]),
            {
              "landcover": 2,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.58256816864014, 8.826660515093511],
                  [-83.58248233795166, 8.825557928804699],
                  [-83.58100175857544, 8.82572755767895],
                  [-83.58145236968994, 8.827042178810473]]]),
            {
              "landcover": 2,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.57308387756348, 8.866075807508214],
                  [-83.57274055480957, 8.864803728462189],
                  [-83.57050895690918, 8.865482171168287],
                  [-83.57119560241699, 8.866839052821218]]]),
            {
              "landcover": 2,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.32640647888184, 8.724678602123037],
                  [-83.3263635635376, 8.72361813172963],
                  [-83.32473278045654, 8.724084739073795],
                  [-83.3249044418335, 8.725145208141928]]]),
            {
              "landcover": 2,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.32713603973389, 8.718994445626903],
                  [-83.32709312438965, 8.718358154068639],
                  [-83.32617044448853, 8.71833694433137],
                  [-83.32617044448853, 8.71907928441945]]]),
            {
              "landcover": 2,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.47315549850464, 8.69871742208389],
                  [-83.47319841384888, 8.697741721696067],
                  [-83.47225427627563, 8.697699299882405],
                  [-83.47223281860352, 8.698759843782224]]]),
            {
              "landcover": 2,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.46184730529785, 8.68484526915223],
                  [-83.46180438995361, 8.683996802774171],
                  [-83.46062421798706, 8.683933167718447],
                  [-83.46064567565918, 8.68493011568448]]]),
            {
              "landcover": 2,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.13036918640137, 8.538796102677363],
                  [-83.13032627105713, 8.537862429205813],
                  [-83.1289529800415, 8.537777549686046],
                  [-83.12908172607422, 8.538923421610123]]]),
            {
              "landcover": 2,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.12427520751953, 8.540323927066815],
                  [-83.12427520751953, 8.538371705928004],
                  [-83.12264442443848, 8.53824438681118],
                  [-83.12281608581543, 8.540493684954656]]]),
            {
              "landcover": 2,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.1395959854126, 8.555516958727264],
                  [-83.13951015472412, 8.554371136674957],
                  [-83.1381368637085, 8.554243822900803],
                  [-83.13843727111816, 8.555856460895582]]]),
            {
              "landcover": 2,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.58110904693604, 8.865100547300292],
                  [-83.5810661315918, 8.864337298374954],
                  [-83.5801649093628, 8.864294895610373],
                  [-83.58029365539551, 8.865142949971874]]]),
            {
              "landcover": 2,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.47055912017822, 8.69460249450886],
                  [-83.47055912017822, 8.693838894729055],
                  [-83.46965789794922, 8.69379647247345],
                  [-83.46970081329346, 8.694729760987531]]]),
            {
              "landcover": 2,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.32095623016357, 8.724551345834875],
                  [-83.32129955291748, 8.724084739073795],
                  [-83.3208703994751, 8.723787807194974],
                  [-83.32056999206543, 8.724127157894364]]]),
            {
              "landcover": 2,
              "system:index": "14"
            })]),
    Water = /* color: #003399 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.57059478759766, 8.802551290915767],
                  [-83.56999397277832, 8.799497767764725],
                  [-83.56801986694336, 8.800091510350637],
                  [-83.56922149658203, 8.80297538936056]]]),
            {
              "landcover": 3,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.55866432189941, 8.804756597519882],
                  [-83.5579776763916, 8.801024532489702],
                  [-83.55626106262207, 8.801194172625891],
                  [-83.55720520019531, 8.804332501116992]]]),
            {
              "landcover": 3,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.58037948608398, 8.846315682763306],
                  [-83.58037948608398, 8.844958725380222],
                  [-83.57754707336426, 8.845043535363178],
                  [-83.57763290405273, 8.84648530208452]]]),
            {
              "landcover": 3,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.57145309448242, 8.89092286728654],
                  [-83.57145309448242, 8.889311675558611],
                  [-83.5689640045166, 8.8891420760171],
                  [-83.56887817382812, 8.891177265332562]]]),
            {
              "landcover": 3,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.14925193786621, 8.5968066864114],
                  [-83.14925193786621, 8.593666618228527],
                  [-83.1459903717041, 8.593666618228527],
                  [-83.14659118652344, 8.59774021517892]]]),
            {
              "landcover": 3,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.12882423400879, 8.598079679615136],
                  [-83.12796592712402, 8.595958021900074],
                  [-83.12719345092773, 8.597825081316477]]]),
            {
              "landcover": 3,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.12590599060059, 8.59941631787651],
                  [-83.12556266784668, 8.598504009732752],
                  [-83.12463998794556, 8.59897077231329],
                  [-83.1250262260437, 8.599798213656523]]]),
            {
              "landcover": 3,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.32769393920898, 8.786095896144529],
                  [-83.32760810852051, 8.783720830358838],
                  [-83.32529067993164, 8.783466358122293],
                  [-83.32537651062012, 8.786689660213485]]]),
            {
              "landcover": 3,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.12161445617676, 8.546053214030396],
                  [-83.12161445617676, 8.5453741919232],
                  [-83.12075614929199, 8.545331753001348],
                  [-83.12084197998047, 8.546350285822033]]]),
            {
              "landcover": 3,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.6088752746582, 8.799752228989606],
                  [-83.60836029052734, 8.797207608869128],
                  [-83.60458374023438, 8.798055817519488],
                  [-83.60527038574219, 8.800939712392442]]]),
            {
              "landcover": 3,
              "system:index": "9"
            })]),
    Grassland_Pasture = /* color: #f56e3f */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.35313200950623, 8.558158701988756],
                  [-83.35312128067017, 8.557638842313473],
                  [-83.3521020412445, 8.557638842313473],
                  [-83.35213422775269, 8.558381498775157]]]),
            {
              "landcover": 4,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.35212349891663, 8.56717656295541],
                  [-83.35213422775269, 8.566815852620572],
                  [-83.35137248039246, 8.566784025221667],
                  [-83.35143685340881, 8.56729326328461]]]),
            {
              "landcover": 4,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.35014939308167, 8.569171072748375],
                  [-83.35022449493408, 8.568481482779715],
                  [-83.34960222244263, 8.568587573625516],
                  [-83.34958076477051, 8.569308990592026]]]),
            {
              "landcover": 4,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.30657958984375, 8.519570456698501],
                  [-83.30655813217163, 8.518742840954946],
                  [-83.30561399459839, 8.518785282831521],
                  [-83.30563545227051, 8.519740223809178]]]),
            {
              "landcover": 4,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.3047342300415, 8.523538743202044],
                  [-83.3047342300415, 8.52275357748283],
                  [-83.30376863479614, 8.523899494478318],
                  [-83.3043909072876, 8.52404803902255]]]),
            {
              "landcover": 4,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.28366279602051, 8.46838224327747],
                  [-83.28361988067627, 8.467066370071223],
                  [-83.28233242034912, 8.46702392247353],
                  [-83.28237533569336, 8.468424690725357]]]),
            {
              "landcover": 4,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.47652435302734, 8.652941614355697],
                  [-83.4764814376831, 8.651711233037924],
                  [-83.47459316253662, 8.651923368034723],
                  [-83.47455024719238, 8.653281029184075]]]),
            {
              "landcover": 4,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.47421765327454, 8.677198396645151],
                  [-83.47420692443848, 8.676540821970406],
                  [-83.47301602363586, 8.676466579596058],
                  [-83.4730589389801, 8.67728324490639]]]),
            {
              "landcover": 4,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.34802508354187, 8.868969770924945],
                  [-83.34802508354187, 8.868312535813505],
                  [-83.34694147109985, 8.868280734084731],
                  [-83.34701657295227, 8.8690333742604]]]),
            {
              "landcover": 4,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.29630672931671, 8.491642742349411],
                  [-83.29629063606262, 8.491117486587267],
                  [-83.29550743103027, 8.491117486587267],
                  [-83.29545378684998, 8.491663964789321]]]),
            {
              "landcover": 4,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.37805509567261, 8.430389902834156],
                  [-83.37867736816406, 8.429116351790517],
                  [-83.37784051895142, 8.428415896928406],
                  [-83.37708950042725, 8.429965386285744]]]),
            {
              "landcover": 4,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.38773250579834, 8.422132972352935],
                  [-83.38770031929016, 8.421496183762065],
                  [-83.38665962219238, 8.421729673033706],
                  [-83.38687419891357, 8.422472592506258]]]),
            {
              "landcover": 4,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.67197155952454, 8.65440533861737],
                  [-83.67197692394257, 8.653843184320447],
                  [-83.67115080356598, 8.653843184320447],
                  [-83.67110788822174, 8.654453068660526]]]),
            {
              "landcover": 4,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.45532417297363, 8.78643519001467],
                  [-83.45532417297363, 8.785417307472601],
                  [-83.45412254333496, 8.785417307472601],
                  [-83.45395088195801, 8.786774483574261]]]),
            {
              "landcover": 4,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.44210624694824, 8.883714849239471],
                  [-83.442063331604, 8.882824437171964],
                  [-83.44111919403076, 8.882824437171964],
                  [-83.44120502471924, 8.883884451292818]]]),
            {
              "landcover": 4,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.43916654586792, 8.619550186804549],
                  [-83.4391450881958, 8.61901980357882],
                  [-83.43867301940918, 8.618998588234307],
                  [-83.43867301940918, 8.620059354001082]]]),
            {
              "landcover": 4,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.31005573272705, 8.516854172680883],
                  [-83.31001281738281, 8.515962887785346],
                  [-83.30924034118652, 8.51600532997032],
                  [-83.30928325653076, 8.516854172680883]]]),
            {
              "landcover": 4,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.49750995635986, 8.659814704975757],
                  [-83.49746704101562, 8.659008608253036],
                  [-83.49673748016357, 8.659051034439386],
                  [-83.49678039550781, 8.660111687543472]]]),
            {
              "landcover": 4,
              "system:index": "17"
            })]),
    ExposedSoil_Urban = /* color: #ffd665 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.10359001159668, 8.501320053157535],
                  [-83.10367584228516, 8.49902808056175],
                  [-83.10187339782715, 8.49894319242469],
                  [-83.10195922851562, 8.501150277879628]]]),
            {
              "landcover": 5,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.11094999313354, 8.498391419075729],
                  [-83.11094999313354, 8.497627423897166],
                  [-83.1104564666748, 8.497606201787141],
                  [-83.11041355133057, 8.498476307334949]]]),
            {
              "landcover": 5,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.37161779403687, 8.859291335035957],
                  [-83.37170362472534, 8.85818884642932],
                  [-83.37037324905396, 8.858867301347779]]]),
            {
              "landcover": 5,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.4956967830658, 8.613991733637116],
                  [-83.49568605422974, 8.613620459999336],
                  [-83.49495649337769, 8.613609852175768],
                  [-83.4949779510498, 8.61405538050986]]]),
            {
              "landcover": 5,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.49051475524902, 8.615710195441554],
                  [-83.49050402641296, 8.615275276834046],
                  [-83.48990321159363, 8.615275276834046],
                  [-83.48989248275757, 8.615657156613745]]]),
            {
              "landcover": 5,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.47918510437012, 8.954856004535795],
                  [-83.47922801971436, 8.953796196451973],
                  [-83.47819805145264, 8.953796196451973],
                  [-83.47819805145264, 8.954940789049047]]]),
            {
              "landcover": 5,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.44601154327393, 8.960621306392504],
                  [-83.44605445861816, 8.959985431998298],
                  [-83.44541072845459, 8.959943040332442],
                  [-83.44549655914307, 8.960578914800843]]]),
            {
              "landcover": 5,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.48613739013672, 8.952524422674378],
                  [-83.4862232208252, 8.952100497093559],
                  [-83.48484992980957, 8.952100497093559],
                  [-83.48489284515381, 8.95265160025227]]]),
            {
              "landcover": 5,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.1791639328003, 8.648486766374347],
                  [-83.17920684814453, 8.64708666041232],
                  [-83.17791938781738, 8.647001805338297],
                  [-83.1780481338501, 8.64827462944185]]]),
            {
              "landcover": 5,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.16607475280762, 8.639067771510378],
                  [-83.16607475280762, 8.638304058909835],
                  [-83.16487312316895, 8.638304058909835]]]),
            {
              "landcover": 5,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.14405918121338, 8.616389091780269],
                  [-83.14414501190186, 8.615540471166424],
                  [-83.14335107803345, 8.615434393455793],
                  [-83.14311504364014, 8.616261798809601]]]),
            {
              "landcover": 5,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.056640625, 8.662572391227169],
                  [-83.056640625, 8.66193600388682],
                  [-83.055739402771, 8.662148133119919]]]),
            {
              "landcover": 5,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.06749820709229, 8.678057484404288],
                  [-83.06749820709229, 8.677293850937689],
                  [-83.06621074676514, 8.677209002678856],
                  [-83.0661678314209, 8.678227180519245]]]),
            {
              "landcover": 5,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.38339805603027, 8.434507689158588],
                  [-83.38344097137451, 8.43408317713295],
                  [-83.38271141052246, 8.43408317713295],
                  [-83.38271141052246, 8.434592591507739]]]),
            {
              "landcover": 5,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.41794490814209, 8.437436809422818],
                  [-83.41794490814209, 8.436927398798336],
                  [-83.41738700866699, 8.43684249696227]]]),
            {
              "landcover": 5,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.50390434265137, 8.660832929946064],
                  [-83.50399017333984, 8.660323817805441],
                  [-83.50300312042236, 8.660281391762597],
                  [-83.5030460357666, 8.660875355926683]]]),
            {
              "landcover": 5,
              "system:index": "15"
            })]),
    PrimaryForest = /* color: #f6210c */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.52954626083374, 8.54093929905093],
                  [-83.52952480316162, 8.539963191304318],
                  [-83.52755069732666, 8.539920751780425],
                  [-83.52761507034302, 8.541066617268548]]]),
            {
              "landcover": 6,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.52420330047607, 8.566359659648382],
                  [-83.52418184280396, 8.565659455417377],
                  [-83.52287292480469, 8.565680673746344],
                  [-83.5230016708374, 8.56657184249421]]]),
            {
              "landcover": 6,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.60146164894104, 8.62283854619098],
                  [-83.6014723777771, 8.62184673758331],
                  [-83.5993105173111, 8.621799003413535],
                  [-83.59925150871277, 8.622912799137072]]]),
            {
              "landcover": 6,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.65357160568237, 8.637816130605382],
                  [-83.65356087684631, 8.636797843415055],
                  [-83.65204811096191, 8.636819057759547],
                  [-83.65208029747009, 8.637869166321222]]]),
            {
              "landcover": 6,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.32846641540527, 8.699268903787308],
                  [-83.32833766937256, 8.698038674257106],
                  [-83.32666397094727, 8.698123517802726],
                  [-83.3269214630127, 8.69956585513737]]]),
            {
              "landcover": 6,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.4023129940033, 8.740807985272077],
                  [-83.40237736701965, 8.7416457185255],
                  [-83.40383648872375, 8.74160330169718],
                  [-83.4037184715271, 8.740680734486544]]]),
            {
              "landcover": 6,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.4336519241333, 8.747880939752822],
                  [-83.43363046646118, 8.747509798553951],
                  [-83.4332013130188, 8.747520402593333],
                  [-83.43321204185486, 8.747870335723707]]]),
            {
              "landcover": 6,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.55553150177002, 8.60745726438729],
                  [-83.55553150177002, 8.606693487889304],
                  [-83.55411529541016, 8.606778352020733],
                  [-83.55402946472168, 8.607711856210797]]]),
            {
              "landcover": 6,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.72144222259521, 8.591417634491783],
                  [-83.72135639190674, 8.590356788476969],
                  [-83.71959686279297, 8.590441656267346],
                  [-83.71976852416992, 8.591714670844155]]]),
            {
              "landcover": 6,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.70058536529541, 8.589847581335887],
                  [-83.70049953460693, 8.588829165002979],
                  [-83.6984395980835, 8.588956467194127],
                  [-83.69861125946045, 8.590059751061085]]]),
            {
              "landcover": 6,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.34219932556152, 8.422960795954467],
                  [-83.34215641021729, 8.422196651154378],
                  [-83.34074020385742, 8.422239103682859],
                  [-83.34078311920166, 8.423342867788614]]]),
            {
              "landcover": 6,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.35020303726196, 8.426038586117787],
                  [-83.35022449493408, 8.425550386553507],
                  [-83.34928035736084, 8.425507934388358],
                  [-83.34930181503296, 8.42612349032694]]]),
            {
              "landcover": 6,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.3462119102478, 8.424658890107114],
                  [-83.34629774093628, 8.423958427172245],
                  [-83.3452033996582, 8.423958427172245],
                  [-83.34524631500244, 8.424743794619094]]]),
            {
              "landcover": 6,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.32157850265503, 8.424743794619094],
                  [-83.32155704498291, 8.424149462643895],
                  [-83.32029104232788, 8.424107010325013],
                  [-83.32029104232788, 8.424807472990857]]]),
            {
              "landcover": 6,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.33546161651611, 8.425560999594074],
                  [-83.33550453186035, 8.425030347209452],
                  [-83.33422780036926, 8.425019734154343],
                  [-83.33425998687744, 8.425560999594074]]]),
            {
              "landcover": 6,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.51128578186035, 8.482050079392366],
                  [-83.5111141204834, 8.481158713588783],
                  [-83.50948333740234, 8.481158713588783],
                  [-83.50969791412354, 8.482304754956417]]]),
            {
              "landcover": 6,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.55986595153809, 8.58577389960108],
                  [-83.55986595153809, 8.584415995970677],
                  [-83.55823516845703, 8.584500865089915],
                  [-83.55823516845703, 8.586367980911534]]]),
            {
              "landcover": 6,
              "system:index": "16"
            })]),
    SecondaryForest = /* color: #00a600 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.66801261901855, 8.568078337295722],
                  [-83.66799116134644, 8.567356917994534],
                  [-83.66696119308472, 8.567356917994534],
                  [-83.66700410842896, 8.568332955545857]]]),
            {
              "landcover": 7,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.43837261199951, 8.481965187500164],
                  [-83.43838334083557, 8.481264828673833],
                  [-83.43733191490173, 8.481264828673833],
                  [-83.43740701675415, 8.481965187500164]]]),
            {
              "landcover": 7,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.34202766418457, 8.402922722553452],
                  [-83.34204912185669, 8.402498175892502],
                  [-83.34125518798828, 8.40245572120085],
                  [-83.341383934021, 8.402901495231442]]]),
            {
              "landcover": 7,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.34267139434814, 8.408654056985192],
                  [-83.34267139434814, 8.40801724623229],
                  [-83.34168434143066, 8.407953565099463],
                  [-83.34174871444702, 8.408738965006519]]]),
            {
              "landcover": 7,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.3466625213623, 8.410330986962459],
                  [-83.34653377532959, 8.409694178964848],
                  [-83.34569692611694, 8.409800313703778],
                  [-83.34589004516602, 8.410670617466629]]]),
            {
              "landcover": 7,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.28793287277222, 8.447879579115162],
                  [-83.28799724578857, 8.447327732503574],
                  [-83.28685998916626, 8.447306507618135],
                  [-83.28692436218262, 8.447879579115162]]]),
            {
              "landcover": 7,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.211350440979, 8.696214533377528],
                  [-83.21126461029053, 8.695281248562178],
                  [-83.20976257324219, 8.695408514810271],
                  [-83.20980548858643, 8.69655390909754]]]),
            {
              "landcover": 7,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.23559761047363, 8.740033875654914],
                  [-83.23559761047363, 8.73918553450187],
                  [-83.2340955734253, 8.739270368704064],
                  [-83.23422431945801, 8.740627713313076]]]),
            {
              "landcover": 7,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.21491241455078, 8.736301160139638],
                  [-83.21474075317383, 8.735452810492108],
                  [-83.2135820388794, 8.735452810492108],
                  [-83.21371078491211, 8.736555664657516]]]),
            {
              "landcover": 7,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.2922887802124, 8.772460266852008],
                  [-83.29209566116333, 8.77178165323963],
                  [-83.29110860824585, 8.772014926808776],
                  [-83.29140901565552, 8.772735953277747]]]),
            {
              "landcover": 7,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.32964658737183, 8.771611999642762],
                  [-83.32930326461792, 8.770997004704283],
                  [-83.32868099212646, 8.771484759394214],
                  [-83.32908868789673, 8.771993720126732]]]),
            {
              "landcover": 7,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.50703716278076, 8.738379608617986],
                  [-83.50677967071533, 8.737234342522479],
                  [-83.50536346435547, 8.737743350110419],
                  [-83.5059642791748, 8.739100700280364]]]),
            {
              "landcover": 7,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.70985507965088, 8.669318030812725],
                  [-83.70895385742188, 8.668427104220985],
                  [-83.7083101272583, 8.669445305867699],
                  [-83.70929718017578, 8.67012410543277]]]),
            {
              "landcover": 7,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.72779369354248, 8.629987977184776],
                  [-83.72663497924805, 8.628927239297788],
                  [-83.72581958770752, 8.629987977184776],
                  [-83.7271499633789, 8.63092142405991]]]),
            {
              "landcover": 7,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.5788345336914, 8.672839291429186],
                  [-83.57874870300293, 8.672075647351187],
                  [-83.57750415802002, 8.672075647351187],
                  [-83.5775899887085, 8.673348386618688]]]),
            {
              "landcover": 7,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.5513687133789, 8.666390692651959],
                  [-83.55149745941162, 8.665202780808535],
                  [-83.54999542236328, 8.66511792981894],
                  [-83.54999542236328, 8.666390692651959]]]),
            {
              "landcover": 7,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.50871086120605, 8.629054528001591],
                  [-83.50858211517334, 8.628333224779338],
                  [-83.5074234008789, 8.628545372928924],
                  [-83.50768089294434, 8.629521252881666]]]),
            {
              "landcover": 7,
              "system:index": "16"
            })]),
    NegraForra = /* color: #7cd0f5 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.5351037979126, 8.86764469893084],
                  [-83.53484630584717, 8.865991002375539],
                  [-83.53334426879883, 8.866499832877917],
                  [-83.53385925292969, 8.8681959294612]]]),
            {
              "landcover": 8,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.5345458984375, 8.85250673734347],
                  [-83.53441715240479, 8.85174346227111],
                  [-83.53351593017578, 8.8520402916541],
                  [-83.53368759155273, 8.852761162015685]]]),
            {
              "landcover": 8,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.52137088775635, 8.864125284503157],
                  [-83.52137088775635, 8.86370125639254],
                  [-83.52046966552734, 8.86370125639254],
                  [-83.52059841156006, 8.864252492840906]]]),
            {
              "landcover": 8,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.54025363922119, 8.869340790226412],
                  [-83.53999614715576, 8.868789561414673],
                  [-83.53930950164795, 8.869128779242901],
                  [-83.53952407836914, 8.869637605397665]]]),
            {
              "landcover": 8,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.53531837463379, 8.88057719709962],
                  [-83.53480339050293, 8.879813980357108],
                  [-83.53385925292969, 8.88006838611445],
                  [-83.53428840637207, 8.881510015405473]]]),
            {
              "landcover": 8,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.53561878204346, 8.845552394850715],
                  [-83.5354471206665, 8.844958725380222],
                  [-83.53450298309326, 8.845382775099681],
                  [-83.53484630584717, 8.846018848763118]]]),
            {
              "landcover": 8,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.5204267501831, 8.89009607241668],
                  [-83.5204267501831, 8.889438875163206],
                  [-83.5196328163147, 8.889502474948932],
                  [-83.51967573165894, 8.890286871398441]]]),
            {
              "landcover": 8,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.53103756904602, 8.901967819680541],
                  [-83.53094100952148, 8.901278844874488],
                  [-83.53003978729248, 8.901331842982561],
                  [-83.53012561798096, 8.902116214084307]]]),
            {
              "landcover": 8,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.5321855545044, 8.871291285530402],
                  [-83.53209972381592, 8.870485647421871],
                  [-83.53119850158691, 8.87040084330761],
                  [-83.53124141693115, 8.871545697197341]]]),
            {
              "landcover": 8,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.51802349090576, 8.870994471696125],
                  [-83.51793766021729, 8.87040084330761],
                  [-83.51742267608643, 8.87040084330761],
                  [-83.51755142211914, 8.871036873687132]]]),
            {
              "landcover": 8,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-83.52596282958984, 8.87763032368192],
                  [-83.52594137191772, 8.877291113711442],
                  [-83.52538347244263, 8.877291113711442],
                  [-83.52544784545898, 8.878181539214921]]]),
            {
              "landcover": 8,
              "system:index": "10"
            })]);

/*The structure for this code was adapted from the US Virgin Islands Ecological Forecasting Summer 2017 code*/ 
//This code contains 1997 Training Data


/////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////// Dictionary ////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////// 

/*These elements are specific to the sensor and are different for Landsat 5 imagery.*/
var falseColor = {bands: ['B4', 'B3', 'B2']};
var trueColor = {bands: ['B3','B2','B1'],min: 0, max: 0.2, gamma: 1.3};


var collection = ee.ImageCollection('LANDSAT/LT05/C01/T1_SR'); 
var bandNames = ee.List(['B1','B2','B3','B4','B5','B7','elevation','slope',]);
var sensor_band_dict =ee.Dictionary({
    L5 : ee.List([0,1,2,3,4,5,'elevation', 'slope']),
});

/*Peninsula boundaries. Change this to match your Osa Peninsula Asset in Google Earth Engine.
To use this code for a separate study area, import a shapefile as an Asset, and insert it here*/

var studyArea = ee.FeatureCollection('projects/ee-developgeo/assets/2018Sum_GA_OsaPeninsulaWater_StudyArea');
Map.centerObject(studyArea);


/*possible years for study with Landsat 5*/
var YEARS = {'1987': 1987, '1988': 1988, '1998': 1998,'1999': 1999,'2000': 2000,'2001':2001
};

/*add training points. We used the classes Palm, Mangrove, Wetland, Water, Grassland, Urban, Primary Forest, and Secondary Forest 
These points were created based on ground truth data provided by Osa Conservation for 2018 and historical imagery. 
To use this code with another study area, create new training points and insert them here.*/

var newfc1= PalmPlantation //1
.merge(Mangrove)           //2
.merge(Water)              //3
.merge(Grassland_Pasture)  //4
.merge(ExposedSoil_Urban)  //5
.merge(PrimaryForest)      //6 
.merge(SecondaryForest)    //7
.merge(NegraForra);        //8

//DEM layers
var DEM1 = ee.Image('JAXA/ALOS/AW3D30_V1_1').select('AVE').clip(studyArea);

/////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////// User Interface/////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
//*****The following UI code was adapted from the Chile Water Resources Team 2017 Summer Code****

// Create UI Panels 
var panel = ui.Panel({style: {width:'300px'}});
ui.root.insert(0,panel);

//intro
var intro = ui.Label('USVI Classification Tool', 
{fontWeight: 'bold', fontSize: '24px', margin: '10px 5px'}
);

var subtitle = ui.Label('This script analyzes landsat 5 imagery',
  {margin: '0 0 0 12px',fontSize: '12px',color: 'gray'});
panel.add(intro).add(subtitle);

//select year
var selectYear = ui.Select({
  items: Object.keys(YEARS),
});
selectYear.setPlaceholder('Select year of study...');
panel.add(ui.Label('1. Select year')).add(selectYear); 


/// Create Land Use Map
var mapbutton = ui.Label('2. Create Land Use Map');
panel.add(mapbutton);
panel.add(ui.Button("Create Map",landMap));
var additional_directions = ui.Label
  ('Classified Imagery may take up to a couple minutes to display. Click tasks to export classified image to drive. Click layers to flip from composite to classified image.', 
  {margin: '0 0 0 12px',fontSize: '12px',color: 'gray'});
panel.add(additional_directions);

var outputPanel = ui.Panel();
print(outputPanel);

/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////// Define terms based on user input //////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
function landMap(){
 var yearNum = (ee.Number.parse(selectYear.getValue()));
 var startDate = ee.Date.fromYMD(yearNum.subtract(2),1,1);
 var endDate =ee.Date.fromYMD(yearNum,12,31);
 var newfc = newfc1; 
 var DEM = DEM1; 
 var elevation = DEM.select('AVE').rename('elevation');
 var slope = ee.Terrain.slope(DEM);

/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////// Create cloud free composite //////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////

//functions to add bands NDVI, EVI, NDWI, NDBI, NDMI, Tasseled-Cap indices, and mask using pixel_qa band
function bandFloat(img) {
  return img.toFloat().divide(10000);
}
function ndvi_calc(img){
  return img.normalizedDifference(['B4', 'B3']).select([0],['NDVI']); 
}
function evi_calc(img){
  return img.expression(                                           
    '2.5 * ((NIR - RED) / (NIR + 6 * RED - 7.5 * BLUE + 1))', {
      'NIR': img.select('B4'),
      'RED': img.select('B3'),
      'BLUE': img.select('B1')
  }).select([0],['EVI']);
}
function ndwi_calc(img){
  return img.normalizedDifference(['B2', 'B4']).select([0],['NDWI']);
}
function ndbi_calc(img){
  return img.normalizedDifference(['B5', 'B4']).select([0],['NDBI']);
}
function ndmi_calc(img){
  return img.normalizedDifference(['B4','B5']).select([0],['NDMI']);
}
function tcb_calc(img){
  return img.expression(
    '(0.2043 * BLUE) + (0.4158 * GREEN) + (0.5524 * RED) + (0.5741 * NIR) + (0.3124 * SWIR1) + (0.2303 * SWIR2)', {
      'SWIR2': img.select('B7'),
      'SWIR1': img.select('B5'),
      'NIR': img.select('B4'),
      'RED': img.select('B3'),
      'GREEN': img.select('B2'),
      'BLUE': img.select('B1')
    }).select([0],['TCB']);
}
function tcg_calc(img){
  return img.expression(
    '(-0.1603 * BLUE) + (0.2819 * GREEN) + (-0.4934 * RED) + (0.7940 * NIR) + (-0.0002 * SWIR1) + (-0.1446 * SWIR2)', {
      'SWIR2': img.select('B7'),
      'SWIR1': img.select('B5'),
      'NIR': img.select('B4'),
      'RED': img.select('B3'),
      'GREEN': img.select('B2'),
      'BLUE': img.select('B1')
    }).select([0],['TCG']);
}
function tcw_calc(img){
  return img.expression(
    '(0.0315 * BLUE) + (0.2021 * GREEN) + (0.3102 * RED) + (0.1594 * NIR) + (-0.6806 * SWIR1) + (-0.6109 * SWIR2)', {
      'SWIR2': img.select('B7'),
      'SWIR1': img.select('B5'),
      'NIR': img.select('B4'),
      'RED': img.select('B3'),
      'GREEN': img.select('B2'),
      'BLUE': img.select('B1')
    }).select([0],['TCW']);
}

function addIndices(in_image){
    return in_image.addBands([ndvi_calc(in_image), evi_calc(in_image), ndwi_calc(in_image), 
    ndbi_calc(in_image), ndmi_calc(in_image), tcb_calc(in_image), tcg_calc(in_image), tcw_calc(in_image)]);
}
function addDEM(in_image){
    return in_image.addBands([elevation, slope]);
}

//Function to mask clouds using cfmask
function mask_sr(image_sr) {
  var mask_band = image_sr.select('pixel_qa').lt(69);
  return image_sr.mask(mask_band);
}

//applies functions for gathering, cloud masking, and cloud shadow masking Landsat imagery
function LEDAPScfmaskImages(startDate,endDate){
  return ee.ImageCollection(collection)
        .filterDate(startDate,endDate)
        .filterBounds(studyArea)
        .map(addDEM)
        .map(mask_sr)
        .select(sensor_band_dict.get('L5'),bandNames)
        .map(bandFloat)
        .map(addIndices); 
}
/*function to calculate maximum value composite based on NDVI percentile
parameters: landsat image collection, studyarea, percentile value*/
function maxvalcompNDVI(collection,studyArea,percc){
  
  var ndvi_loc=collection.select('NDVI').toArray().clip(studyArea)
  .arrayLength(0).multiply(percc/100).floor().int();
  
  var ndvi_loc2=collection.select('NDVI').toArray().clip(studyArea)
  .arrayLength(0).multiply(percc/100).add(1).floor().int();
  
  var bandNames=ee.Image(collection.first()).bandNames();
  var nb=ee.Image(collection.first()).bandNames().length().subtract(1);
  var out_list = ee.List.sequence(0,nb).map(function(i) {
  return collection.select([bandNames.get(i)])
  .toArray().arraySort().clip(studyArea)
  .arraySlice(0,ndvi_loc,ndvi_loc2, 1)
  .arrayFlatten([['0'],['0']]).rename([bandNames.get(i)]);});
  
  var first=out_list.slice(0,1).get(0);
  function combine(img, prev){return ee.Image(prev).addBands(img)}
  return ee.Image(out_list.slice(1,nb.add(1)).iterate(combine,first));
  
}//credits: Richard Massey, PhD student,  Northern Arizona University

//Get all images and cloud and shadow mask them
var allImages = LEDAPScfmaskImages(startDate,endDate);

//number of bands per season image
var nbf=ee.Image(allImages.first()).bandNames().length();

//reduce collections to maximum value composite based on NDVI percentile
var pctl=35; //range: 0-99
var compImage = maxvalcompNDVI(allImages,studyArea,pctl);
print('Output Image:',compImage);


var yearName = ee.String(ee.Number.parse(selectYear.getValue()))
Map.addLayer(compImage.clip(studyArea), trueColor, 'GP Comp '+ yearName.getInfo());


/////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////// Classification ////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
// **** the following is adapted from Everglades Fall 2016 Ecological Forescasting team code ******


//Create a dictionary explaining the class meanings  
var classes = [
  {'landcover':1,'description':'PalmPlantation'},
  {'landcover':2,'description':'Mangrove'},
  {'landcover':3,'description':'Water'},
  {'landcover':4,'description':'Grassland_Pasture'},
  {'landcover':5,'description':'ExposedSoil_Urban'},
  {'landcover':6,'description':'Primary Forest'},
  {'landcover':7,'description':'SecondaryForest'},
  {'landcover':8,'description':'NegraForra'}
];
print('Class Descriptions', classes);

//use these bands for classification
var cBands=['B1','B2', 'B3','B4','B5','B7','slope', 'NDVI', 'EVI', 'NDWI', 'NDBI', 'NDMI', 'TCB', 'TCG', 'TCW'];


//add a random number column to geometry imports, use seed (1, 2, and 3)
var newfc2 = ee.FeatureCollection(newfc).randomColumn('random', 2);

 
//define your classification samples to incl. newfc2 and the properties to be considered
var samples = compImage.select(cBands).sampleRegions({
     collection: newfc2,   
     properties: ['landcover', 'random'], 
    scale: 30 
});


//split training points (80% and 20%)  
var training = samples.filterMetadata('random', 'less_than', 0.8);
var testing = samples.filterMetadata('random', 'not_less_than', 0.8);

//only use the 80% for classification
var classifier = ee.Classifier.smileRandomForest(200).train({
      features: training, 
     classProperty: 'landcover'
});

//apply classifier
var classified = compImage.classify(classifier);

//to validate, compare 20% testing points to the classification product in errorMatrix
var validation = testing.classify(classifier);                                     
var errorMatrix = validation.errorMatrix('landcover', 'classification');           
print('Error Matrix:', errorMatrix);
print('Overall Accuracy:', errorMatrix.accuracy());
print('Kappa Coefficient: ', errorMatrix.kappa());


//CSS color codes to display map
var palette = ['f5f907', // PalmPlantation(1) - yellow
              '22f7aa', // Mangrove(2) - blue/green
              '003399' , // Water(3) - dark blue
              'f56e3f' , // Grassland_Pasture(4) - red
              'eecb66', // ExposedSoil_Urban(5) - tan
              '004d00', // PrimaryForest(6) - dark green
              '00a600', // SecondaryForest(7) - light green
              '7cd0f5', // Wetland(8) - light blue
];
 
Map.addLayer(classified, 
    {min: 1, max: 8, palette: palette}, 'Classification '+ yearName.getInfo());


////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////EXPORT CODE ///////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////

//Export the classified image to the Drive (to finish the process, select run in 'Tasks')

Export.image.toDrive({
  image: classified,
  //assetId: 'classi',
  folder: 'exports',
  description: 'CLASSIFIED_IMAGE_1997', //change for each photo
  scale: 30,
  region: studyArea.geometry().bounds()
});

//Export the composite image to the Drive (to finish the process, select run in 'Tasks')
Export.image.toDrive({
  image: compImage,
  folder: 'exports',
  description: 'LS_Composite', //change for each photo
  scale: 30,
  region: studyArea.geometry().bounds()
});

}



////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////Classification Legend //////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////


// set position of panel
var legend = ui.Panel({
  style: {
    position: 'bottom-right',
    padding: '8px 15px'
  }
});
 
// Create legend title
var legendTitle = ui.Label({
  value: 'Classification Legend',
  style: {
    fontWeight: 'bold',
    fontSize: '18px',
    margin: '0 0 4px 0',
    padding: '0'
    }
});
 
// Add the title to the panel
legend.add(legendTitle);
 
// Creates and styles 1 row of the legend.
var makeRow = function(color, name) {
 
      // Create the label that is actually the colored box.
      var colorBox = ui.Label({
        style: {
          backgroundColor: '#' + color,
          // Use padding to give the box height and width.
          padding: '8px',
          margin: '0 0 4px 0'
        }
      });
 
      // Create the label filled with the description text.
      var description = ui.Label({
        value: name,
        style: {margin: '0 0 4px 6px'}
      });
 
      // return the panel
      return ui.Panel({
        widgets: [colorBox, description],
        layout: ui.Panel.Layout.Flow('horizontal')
      });
};
 
 
//CSS color codes to display map
var paletteKey = {
              'f5f907': 'Palm Plantation',
              '22f7aa': 'Mangrove',
              '003399': 'Water',
              'f56e3f': 'Grassland, Pasture',
              'eecb66': 'Exposed Soil, Urban',
              '004d00': 'Primary Forest',
              '00a600': 'Secondary Forest',
              '7cd0f5': 'Wetland'
};

legend.add(makeRow('f5f907', 'Palm Plantation'));
legend.add(makeRow('22f7aa', 'Mangrove'));
legend.add(makeRow('003399', 'Water'));
legend.add(makeRow('f56e3f', 'Grassland, Pasture'));
legend.add(makeRow('eecb66', 'Exposed Soil, Urban'));
legend.add(makeRow('004d00', 'Primary Forest'));
legend.add(makeRow('00a600', 'Secondary Forest'));
legend.add(makeRow('7cd0f5', 'Wetland'));
 
 
// add legend to map (alternatively you can also print the legend to the console)
Map.add(legend);
